<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue音乐项目总结 | ming的个人网站</title>
    <meta name="description" content="Welcome to come to my blog">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.70f2d267.css" as="style"><link rel="preload" href="/assets/js/app.f3f0b164.js" as="script"><link rel="preload" href="/assets/js/2.284f78c8.js" as="script"><link rel="preload" href="/assets/js/15.8e83af5f.js" as="script"><link rel="prefetch" href="/assets/js/10.d3bd6822.js"><link rel="prefetch" href="/assets/js/11.7be908fe.js"><link rel="prefetch" href="/assets/js/12.71222861.js"><link rel="prefetch" href="/assets/js/13.0e9f2f34.js"><link rel="prefetch" href="/assets/js/14.70e31408.js"><link rel="prefetch" href="/assets/js/16.3f82f6aa.js"><link rel="prefetch" href="/assets/js/17.9c893c24.js"><link rel="prefetch" href="/assets/js/18.8ce12f88.js"><link rel="prefetch" href="/assets/js/19.4539c1e6.js"><link rel="prefetch" href="/assets/js/20.8d6b15a2.js"><link rel="prefetch" href="/assets/js/21.aa90be3e.js"><link rel="prefetch" href="/assets/js/22.0741e8cf.js"><link rel="prefetch" href="/assets/js/23.26e38199.js"><link rel="prefetch" href="/assets/js/24.437832b0.js"><link rel="prefetch" href="/assets/js/25.3ac7a3f9.js"><link rel="prefetch" href="/assets/js/26.f3036c64.js"><link rel="prefetch" href="/assets/js/27.85d3ca2e.js"><link rel="prefetch" href="/assets/js/28.f59e28e7.js"><link rel="prefetch" href="/assets/js/29.74627ca0.js"><link rel="prefetch" href="/assets/js/3.c17543fc.js"><link rel="prefetch" href="/assets/js/30.7b42eae2.js"><link rel="prefetch" href="/assets/js/31.9c88f4b6.js"><link rel="prefetch" href="/assets/js/32.3302434b.js"><link rel="prefetch" href="/assets/js/33.bd99df5c.js"><link rel="prefetch" href="/assets/js/34.a20acac1.js"><link rel="prefetch" href="/assets/js/35.d2d4f756.js"><link rel="prefetch" href="/assets/js/36.18286c43.js"><link rel="prefetch" href="/assets/js/37.84831a8a.js"><link rel="prefetch" href="/assets/js/38.ce143c7c.js"><link rel="prefetch" href="/assets/js/39.11e44bd7.js"><link rel="prefetch" href="/assets/js/4.24ba765a.js"><link rel="prefetch" href="/assets/js/40.cb8f8018.js"><link rel="prefetch" href="/assets/js/41.f6a28df9.js"><link rel="prefetch" href="/assets/js/42.fbd48b3c.js"><link rel="prefetch" href="/assets/js/43.131d6d97.js"><link rel="prefetch" href="/assets/js/44.2c119204.js"><link rel="prefetch" href="/assets/js/45.198a5b50.js"><link rel="prefetch" href="/assets/js/46.c2f0e139.js"><link rel="prefetch" href="/assets/js/47.71dfa535.js"><link rel="prefetch" href="/assets/js/48.cb8ad619.js"><link rel="prefetch" href="/assets/js/49.cbeee829.js"><link rel="prefetch" href="/assets/js/5.e87ba801.js"><link rel="prefetch" href="/assets/js/50.ff87b9b9.js"><link rel="prefetch" href="/assets/js/51.8943f310.js"><link rel="prefetch" href="/assets/js/52.f08a077e.js"><link rel="prefetch" href="/assets/js/53.5b096969.js"><link rel="prefetch" href="/assets/js/54.39e8487d.js"><link rel="prefetch" href="/assets/js/55.581e549d.js"><link rel="prefetch" href="/assets/js/56.d60cbfa0.js"><link rel="prefetch" href="/assets/js/6.b35a0751.js"><link rel="prefetch" href="/assets/js/7.aa04d747.js"><link rel="prefetch" href="/assets/js/8.2805aa08.js"><link rel="prefetch" href="/assets/js/9.2159abe2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.70f2d267.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ming的个人网站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/page13/page1/" class="nav-link">
  前端技术
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人文章" class="dropdown-title"><span class="title">个人文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://segmentfault.com/u/helloxiaoming" target="_blank" rel="noopener noreferrer" class="nav-link external">
  segmentfault
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/shifengming" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/page13/page1/" class="nav-link">
  前端技术
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人文章" class="dropdown-title"><span class="title">个人文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://segmentfault.com/u/helloxiaoming" target="_blank" rel="noopener noreferrer" class="nav-link external">
  segmentfault
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/shifengming" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JQuery</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Github</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Http请求</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ajax</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/page13/vue_element电商后台管理系统总结.html" class="sidebar-link">Vue_element电商后台管理系统总结</a></li><li><a href="/page13/vue去哪儿项目总结.html" class="sidebar-link">vue去哪儿项目总结</a></li><li><a href="/page13/vue饿了么项目总结.html" class="sidebar-link">vue饿了么项目总结</a></li><li><a href="/page13/react_antd后台管理系统总结.html" class="sidebar-link">react_antd后台管理系统总结</a></li><li><a href="/page13/vue音乐项目总结.html" class="active sidebar-link">vue音乐项目总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#架构支持" class="sidebar-link">架构支持</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#工具支持" class="sidebar-link">工具支持</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#项目介绍" class="sidebar-link">项目介绍</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#技术栈" class="sidebar-link">技术栈</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#源码" class="sidebar-link">源码</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#效果图" class="sidebar-link">效果图</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#项目目录" class="sidebar-link">项目目录</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#搭建运行环境" class="sidebar-link">搭建运行环境</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#推荐页面-2" class="sidebar-link">推荐页面</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#歌手页面-2" class="sidebar-link">歌手页面</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#歌手详情页-2" class="sidebar-link">歌手详情页</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#播放器页面-2" class="sidebar-link">播放器页面</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#歌单页面-2" class="sidebar-link">歌单页面</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#排行榜页面-2" class="sidebar-link">排行榜页面</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#榜单列表页-2" class="sidebar-link">榜单列表页</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#搜索页面-2" class="sidebar-link">搜索页面</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#歌典列表页-2" class="sidebar-link">歌典列表页</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#用户中心页-2" class="sidebar-link">用户中心页</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#手机联调" class="sidebar-link">手机联调</a></li><li class="sidebar-sub-header"><a href="/page13/vue音乐项目总结.html#移动端调试工具" class="sidebar-link">移动端调试工具</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue音乐项目总结"><a href="#vue音乐项目总结" class="header-anchor">#</a> vue音乐项目总结</h1> <h2 id="架构支持"><a href="#架构支持" class="header-anchor">#</a> 架构支持</h2> <ul><li>基础组件库</li> <li>状态管理vuex</li> <li>路由vue-router</li> <li>服务端通讯axios&amp;jsonp</li> <li>第三方插件</li></ul> <h2 id="工具支持"><a href="#工具支持" class="header-anchor">#</a> 工具支持</h2> <ul><li>脚手架工具vue-cli</li> <li>自动化构建工具webpack</li> <li>代码检查工具eslint</li></ul> <h2 id="项目介绍"><a href="#项目介绍" class="header-anchor">#</a> 项目介绍</h2> <p>仿QQ音乐webapp是基于Vue2.0、vuex、vue-router、axios和html5的flexible box布局与及css3的transform、animation、transition组成</p> <p>Vuejs是一套MVVM框架，主要注重于view层，实现数据双向绑定与及虚拟DOM，解放你的双手，让你不用直接和真实的DOM进行操作，只要数据改变，vue自动检查DOM结构不同，更新DOM元素结构</p> <p>其中开发过程之中就遇到手动操作DOM，然后再样式表之中写的样式无法发挥作用，所以使用Vuejs构建SPA单页应用的时候应该避免显示地去操作DOM结构</p> <h2 id="技术栈"><a href="#技术栈" class="header-anchor">#</a> 技术栈</h2> <h3 id="前端"><a href="#前端" class="header-anchor">#</a> 前端</h3> <p>Vue: 用于构建用户界面的MVVM框架，它的核心是响应的数据绑定和组系统件</p> <p>Vue-router：为单页面提供的路由系统，项目上线前使用Lazy Loading Routes，来实现异步加载优化性能</p> <p>Vuex：Vue集中状态管理，在多个组件共享某些状态时非常便捷</p> <p>Vue-lazyload：第三方图片懒加载库，优化页面加载速度</p> <p>better-scroll：使移动端滑动体验更加流畅</p> <p>Sass：css预编译处理器</p> <p>ES6：  ECMAScript新一代语法，模块化、解构赋值、Promise、Class等方法非常好用</p> <h3 id="后端"><a href="#后端" class="header-anchor">#</a> 后端</h3> <p>Node.js：利用Express起一个本地测试服务器</p> <p>Jsonp：服务器通讯，抓取QQ音乐(移动端)数据</p> <p>axios：服务器通讯，结合Node.js代理后端请求，抓取QQ音乐(PC端)数据，自动化构建及其他工具</p> <p>vue-cli：Vue脚手架工具，快速初始化项目代码</p> <p>eslint：代码风格检查工具，规范代码书写</p> <p>vConsole：移动端调试工具，在移动端输出日志</p> <h2 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h2> <div class="language- extra-class"><pre class="language-text"><code>https://github.com/shifengming/vue-music
</code></pre></div><h2 id="效果图"><a href="#效果图" class="header-anchor">#</a> 效果图</h2> <h3 id="推荐页面"><a href="#推荐页面" class="header-anchor">#</a> 推荐页面</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3ce066dea4bac?w=606&amp;h=1078&amp;f=png&amp;s=393996" alt="cmd-markdown-logo"></p> <h3 id="歌手页面"><a href="#歌手页面" class="header-anchor">#</a> 歌手页面</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d16b063a9766?w=1242&amp;h=2061&amp;f=jpeg&amp;s=192641" alt="cmd-markdown-logo"></p> <h3 id="歌手详情页"><a href="#歌手详情页" class="header-anchor">#</a> 歌手详情页</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d189f1c537bb?w=1242&amp;h=2067&amp;f=jpeg&amp;s=219582" alt="cmd-markdown-logo"></p> <h3 id="播放器页面"><a href="#播放器页面" class="header-anchor">#</a> 播放器页面</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d1dece40fe23?w=1242&amp;h=2070&amp;f=jpeg&amp;s=363508" alt="cmd-markdown-logo"></p> <h3 id="歌单页面"><a href="#歌单页面" class="header-anchor">#</a> 歌单页面</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f46855efba9786?w=374&amp;h=665&amp;f=png&amp;s=140591" alt="cmd-markdown-logo"></p> <h3 id="排行榜页面"><a href="#排行榜页面" class="header-anchor">#</a> 排行榜页面</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d20cd038149e?w=1242&amp;h=2056&amp;f=jpeg&amp;s=256563" alt="cmd-markdown-logo"></p> <h3 id="榜单列表页"><a href="#榜单列表页" class="header-anchor">#</a> 榜单列表页</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbb2f9dc87f7?w=1242&amp;h=2088&amp;f=jpeg&amp;s=235690" alt="cmd-markdown-logo"></p> <h3 id="搜索页面"><a href="#搜索页面" class="header-anchor">#</a> 搜索页面</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbc52482240f?w=1242&amp;h=2061&amp;f=jpeg&amp;s=160394" alt="cmd-markdown-logo"></p> <h3 id="歌典列表页"><a href="#歌典列表页" class="header-anchor">#</a> 歌典列表页</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbd7d34860dc?w=1242&amp;h=2070&amp;f=jpeg&amp;s=175771" alt="cmd-markdown-logo"></p> <h3 id="用户中心页"><a href="#用户中心页" class="header-anchor">#</a> 用户中心页</h3> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbe1bd20e458?w=1242&amp;h=2079&amp;f=jpeg&amp;s=110868" alt="cmd-markdown-logo"></p> <h2 id="项目目录"><a href="#项目目录" class="header-anchor">#</a> 项目目录</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/26/16f4117118e17e28?w=734&amp;h=2747&amp;f=jpeg&amp;s=314879" alt="cmd-markdown-logo"></p> <h2 id="搭建运行环境"><a href="#搭建运行环境" class="header-anchor">#</a> 搭建运行环境</h2> <p>检查node是否安装</p> <div class="language- extra-class"><pre class="language-text"><code>node -v
</code></pre></div><p>安装vue-cli脚手架</p> <div class="language- extra-class"><pre class="language-text"><code> npm install -g vue-cli
</code></pre></div><p>安装项目模板，这里的vue-music是你模板文件的名字，可自定义</p> <div class="language- extra-class"><pre class="language-text"><code> vue init webpack vue-music
</code></pre></div><p>安装完后会需要填写或确认一些内容，自己根据需要进行填写和确认</p> <p>然后返回包的根目录</p> <div class="language- extra-class"><pre class="language-text"><code> cd vue-music
</code></pre></div><p>再安装依赖</p> <div class="language- extra-class"><pre class="language-text"><code> npm install
</code></pre></div><p>运行</p> <div class="language- extra-class"><pre class="language-text"><code> npm run dev
</code></pre></div><p>安装jsonp</p> <div class="language- extra-class"><pre class="language-text"><code>npm install jsonp -S
</code></pre></div><h2 id="推荐页面-2"><a href="#推荐页面-2" class="header-anchor">#</a> 推荐页面</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3ce066dea4bac?w=606&amp;h=1078&amp;f=png&amp;s=393996" alt="cmd-markdown-logo"></p> <p>上部分是一个轮播图组件，使用第三方库better-srcoll辅助实现，使用jsonp抓取QQ音乐移动端数据</p> <p>用到了es6对象合并方法Object.assign,浅拷贝的方法</p> <div class="language- extra-class"><pre class="language-text"><code>import jsonp from 'common/js/jsonp'
import {commonParams, oprions} from './config'

// 获取推荐信息
export function getRecommend () {
  const url = 'https://c.y.qq.com/musichall/fcgi-bin/fcg_yqqhomepagerecommend.fcg'
  const data = Object.assign({}, commonParams, {
    platform: 'h5',
    uin: 0,
    needNewCode: 1
  })
  return jsonp(url, data, oprions)
}
</code></pre></div><p>因为api/config.js数据是爬的，所以定义了通用的参数对象，私有的参数通过assign方法添加</p> <div class="language- extra-class"><pre class="language-text"><code>// 通用参数
export const commonParams = {
    g_tk: 1928093487,
    inCharset: 'utf-8',
    outCharset: 'utf-8',
    notice: 0,
    format: 'jsonp'
  }
  
  export const oprions = {
    param: 'jsonpCallback'
  }
  
  export const ERR_OK = 0
</code></pre></div><p>components/recommend.vue在组件中调用接口</p> <div class="language- extra-class"><pre class="language-text"><code>  export default {
  name: 'recommend',
  data () {
    return {
      recommends: [], // 轮播数据
    }
  },
   created () {
    // 获取推荐数据
    this._getRecommend()
    // 获取歌单信息
    // setTimeout(() =&gt; {
    //   this._getDiscList()
    // }, 1000)
  },
  methods: {
    _getRecommend () {
      getRecommend().then((res) =&gt; {
        if (res.code === ERR_OK) {
          this.recommends = res.data.slider
        }
      })
    }
  },
  components: {
    Slider
  }
}
</code></pre></div><p>这里用到了slider组件以及slot的知识，有个很需要注意的地方，因为数据响应必须确定有数据v-if=&quot;recommends.length&quot;才能保证插槽的正确性</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!-- 此处通过v-if来解决异步请求，等推荐请求到数据后再执行渲染下面轮播组件 --&gt;
            &lt;div v-if=&quot;recommends.length&quot; class=&quot;slider-wrapper&quot;&gt;
                &lt;slider&gt;
                    &lt;div v-for=&quot;(item,index) in recommends&quot; :key=&quot;index&quot;&gt;
                        &lt;a :href=&quot;item.linkUrl&quot;&gt;
                            &lt;img class=&quot;needsclick&quot; @load=&quot;loadImage&quot; :src=&quot;item.picUrl&quot;/&gt;
                        &lt;/a&gt;
                    &lt;/div&gt;
                &lt;/slider&gt;
             &lt;/div&gt;
</code></pre></div><p>下部分是一个歌单推荐列表，使用 axios + Node.js 代理后端请求，绕过主机限制 (伪造 headers)，抓取 QQ音乐(PC端)数据</p> <div class="language- extra-class"><pre class="language-text"><code>// 获取歌单数据
export function getDiscList () {
  const url = '/api/getDiscList'
  const data = Object.assign({}, commonParams, {
    platform: 'h5',
    hostUin: 0,
    sin: 0,
    ein: 29,
    sortId: 5,
    needNewCode: 0,
    categoryId: 10000000,
    rnd: Math.random(),
    format: 'json',
    g_tk: 219344,
    uin: 2789770398,
    _: 1542077892080
  })

  return axios.get(url, {
    params: data
  }).then((res) =&gt; {
    return Promise.resolve(res.data)
  })
}
</code></pre></div><p>歌单推荐图片，使图片懒加载技术vue-lazyload，优化页面加载速度</p> <p>在入口文件main.js</p> <div class="language- extra-class"><pre class="language-text"><code>import VueLazyLoad from 'vue-lazyload'

Vue.use(VueLazyload, {
  loading: require('common/image/default.png')  //传一个默认参数
})
</code></pre></div><p>为了更好的用户体验，当数据未请求到时，显示loading组件</p> <div class="language- extra-class"><pre class="language-text"><code>  &lt;div class=&quot;loading-container&quot; v-show=&quot;!discList.length&quot;&gt;
    &lt;loading&gt;&lt;/loading&gt;
  &lt;/div&gt;
</code></pre></div><h2 id="歌手页面-2"><a href="#歌手页面-2" class="header-anchor">#</a> 歌手页面</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d16b063a9766?w=1242&amp;h=2061&amp;f=jpeg&amp;s=192641" alt="cmd-markdown-logo"></p> <p>左侧是一个歌手列表，使用 jsonp 抓取 QQ音乐(PC端)歌手数据并重组 JSON 数据</p> <div class="language- extra-class"><pre class="language-text"><code>import jsonp from 'common/js/jsonp'
import {commonParams, oprions} from './config'
/**
 * 获取歌手列表
 */
export function getSingerList () {
  const url = 'https://c.y.qq.com/v8/fcg-bin/v8.fcg'
  const data = Object.assign({}, commonParams, {
    channel: 'singer',
    page: 'list',
    key: 'all_all_all',
    pagesize: 100,
    pagenum: 1,
    hostUin: 0,
    needNewCode: 0,
    platform: 'yqq',
    g_tk: 1664029744
  })
  return jsonp(url, data, oprions)
}
</code></pre></div><p>列表图片使用懒加载技术 vue-lazyload，优化页面加载速度</p> <p>在入口文件main.js</p> <div class="language- extra-class"><pre class="language-text"><code>import VueLazyLoad from 'vue-lazyload'

Vue.use(VueLazyload, {
  loading: require('common/image/default.png')  //传一个默认参数
})
</code></pre></div><p>右侧是一个字母列表，与左侧歌手列表联动，滚动固定标题实现</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
    &lt;div class=&quot;singer&quot; ref=&quot;singer&quot;&gt;
      &lt;list-view @select=&quot;selectSinger&quot; :data=&quot;singers&quot;&gt;&lt;/list-view&gt;
      &lt;router-view&gt;&lt;/router-view&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import {getSingerList} from 'api/singer'
import {ERR_OK} from 'api/config'
import Singer from 'common/js/singer'
import ListView from 'base/listview/listview'
import {mapMutations} from 'vuex'

const HOT_NAME = '热门'
const HOT_SINGER_LEN = 10 // 热门数据10条
export default {
  name: 'singer',
  data () {
    return {
      singers: []
    }
  },
  created () {
    this._getSingerList()
  },
  methods: {
    _getSingerList () {
      getSingerList().then((res) =&gt; {
        console.log(res)
        if (res.code === ERR_OK) {
          this.singers = this._normalizeSinger(res.data.list)
        }
      })
    },
    selectSinger (singer) {
      // console.log(singer)
      // vue的编程式开发
      this.$router.push({
        path: `/singer/${singer.id}`
      })
      //调用被映射出来的方法，把数据传递到vuex里面，到这一步完成setter设置
      this.setSinger(singer)
    },
    // 规范歌手
    _normalizeSinger (list) {
      let map = {
        hot: { // 热门数据
          title: HOT_NAME,
          items: []
        }
      }
      list.forEach((item, index) =&gt; {
        // 整个数据的前十条为热门数据
        if (index &lt; HOT_SINGER_LEN) {
          map.hot.items.push(new Singer({
            name: item.Fsinger_name,
            id: item.Fsinger_mid
          }))
        }
        // 通过Findex进行聚类
        const key = item.Findex
        // 判断map中有没这个key
        if (!map[key]) {
          map[key] = {
            title: key,
            items: []
          }
        }
        map[key].items.push(new Singer({
          name: item.Fsinger_name,
          id: item.Fsinger_mid
        }))
      })
      // console.log(map)
      // 为了得到有序列表，我们需要处理 map
      let ret = [] // 字母A-Z
      let hot = [] // 热门
      for (let key in map) {
        let val = map[key]
        if (val.title.match(/[a-zA-Z]/)) {
          ret.push(val)
        } else if (val.title === HOT_NAME) {
          hot.push(val)
        }
      }
      // 对ret按字母的升序进行排列
      ret.sort((a, b) =&gt; {
        return a.title.charCodeAt(0) - b.title.charCodeAt(0)
      })
      // console.log(hot.concat(ret))
      return hot.concat(ret)
    },
    ...mapMutations({
      setSinger: 'SET_SINGER'
    })
  },
  components: {
    ListView
  }
}
</code></pre></div><h2 id="歌手详情页-2"><a href="#歌手详情页-2" class="header-anchor">#</a> 歌手详情页</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d189f1c537bb?w=1242&amp;h=2067&amp;f=jpeg&amp;s=219582" alt="cmd-markdown-logo"></p> <p>复用歌单详情页，只改变传入的参数，数据同样爬取自 QQ音乐</p> <div class="language- extra-class"><pre class="language-text"><code>export function getSingerDetail (stringId) {
  const url = 'https://c.y.qq.com/v8/fcg-bin/fcg_v8_singer_track_cp.fcg'
  const data = Object.assign({}, commonParams, {
    hostUin: 0,
    needNewCode: 0,
    platform: 'yqq',
    order: 'listen',
    begin: 0,
    num: 80,
    songstatus: 1,
    g_tk: 1664029744,
    singermid: stringId
  })
  return jsonp(url, data, oprions)
}
</code></pre></div><p>详情页里面的transition动画</p> <div class="language- extra-class"><pre class="language-text"><code>.slider-enter-active, .slider-leave-active
transition: all 0.5s
.slider-enter, .slider-leave-to
transform: translate3d(100%, 0, 0)
</code></pre></div><h2 id="播放器页面-2"><a href="#播放器页面-2" class="header-anchor">#</a> 播放器页面</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d1dece40fe23?w=1242&amp;h=2070&amp;f=jpeg&amp;s=363508" alt="cmd-markdown-logo"></p> <p>把播放器组件放在App.vue下</p> <p>因为它是一个跟任何路由都不相关的东西。在任何路由下，它都可以去播放。切换路由并不会影响播放器的播放</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;!--应用相关的播放器--&gt;
&lt;player&gt;&lt;/player&gt;

import Player from 'components/player/player'
export default {
  name: 'App',
  components: {
    Player
  }
}
</code></pre></div><p>点击歌手/歌单 都会进入详情页，详情页created()会根据点击的歌手请求相应的数据，然后利用_normalizeSongs将数据整理，其中很重要的函数是createSong,生成自定义song类，方便以后阅读</p> <div class="language- extra-class"><pre class="language-text"><code>created () {
    // console.log(this.singer)
    this._getDetail()
  },
  methods: {
    _getDetail () {
      // 在歌曲列表详情页刷新时，跳回歌手列表页面
      if (!this.singer.id) {
        this.$router.push('/singer')
        return
      }
      // 获取歌曲列表的接口
      getSingerDetail(this.singer.id).then((res) =&gt; {
        if (res.code === ERR_OK) {
          console.log(res)
          this.songs = this._normallizeSongs(res.data.list)
          // console.log(this.songs)
        }
      })
    },
    _normallizeSongs (list) {
      let ret = []
      // 遍历之前要检查list是否存在，不然会报错：Cannot read property 'forEach' of underfined
      if (!list) {
        return
      }
      list.forEach((item) =&gt; {
        // 对象的结构赋值
        let {musicData} = item
        // if (musicData.songid &amp;&amp; musicData.albummid) {
        //   ret.push(createSong(musicData))
        // }
        if (musicData.songid &amp;&amp; musicData.albummid) {
          getMusic(musicData.songmid).then(res =&gt; {
            // console.log(res)
            if (res.code === ERR_OK) {
              const svkey = res.data.items
              const songVkey = svkey[0].vkey
              const newSong = createSong(musicData, songVkey)
              ret.push(newSong)
            }
          })
        }
      })
      return ret
    }
  },
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>export function createSong1 (musicData) {
  return new Song({
    id: musicData.songid,
    mid: musicData.songmid,
    singer: filerSinger(musicData.singer),
    name: musicData.songname,
    album: musicData.albumname,
    duration: musicData.interval,
    image: `https://y.gtimg.cn/music/photo_new/T002R300x300M000${musicData.albummid}.jpg?max_age=2592000`,
    // 歌源url
    url: `http://ws.stream.qqmusic.qq.com/C100/${musicData.songid}.m4a?fromtag=0&amp;guid=126548448`
  })
}
export function createSong2 (musicData) {
  return new Singer({
    mid: musicData.singerMID,
    singer: musicData.fsinger,
    name: musicData.fsong
  })
}
export function createSong (musicData, songVkey) {
  return new Song({
    id: musicData.songid,
    mid: musicData.songmid,
    singer: filerSinger(musicData.singer),
    name: musicData.songname,
    album: musicData.albumname,
    duration: musicData.interval,
    image: `https://y.gtimg.cn/music/photo_new/T002R300x300M000${musicData.albummid}.jpg?max_age=2592000`,
    // 歌源url
    url: `http://dl.stream.qqmusic.qq.com/C400${musicData.songmid}.m4a?vkey=${songVkey}&amp;guid=1849502645&amp;fromtag=66`
  })
}
</code></pre></div><p>播放器图片旋转</p> <p>animation-play-state CSS 属性定义一个动画是否运行或者暂停。可以通过查询它来确定动画是否正在运行。另外，它的值可以被设置为暂停和恢复的动画的重放</p> <div class="language- extra-class"><pre class="language-text"><code>  &amp;.pause
    animation-play-state: paused
</code></pre></div><p>播放器、进度条功能</p> <p>在progress上监听touchstart、touchmove、touchend三个事件</p> <p>touchstart</p> <blockquote><p>获取第一次点击的横坐标和已播放的进度条长度</p></blockquote> <p>touchmove</p> <blockquote><p>获取移动后的横坐标，并定义delta为移动后坐标，第一次点击的横坐标</p></blockquote> <p>touchend</p> <blockquote><p>一些组件特有的逻辑，和进度条不太相关</p></blockquote> <p>设置 偏移量 offsetWidth 为 已播放的进度条长度 + delta
在去设置 progress 和 progressBtn 的宽度和transform 量都为 offsetWidth</p> <p>而点击任意位置，移动进度按钮，则是通过为 progress 进度条添加点击事件</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;div class=&quot;middle&quot;
     @touchstart.prevent=&quot;middleTouchStart&quot;
     @touchmove.prevent=&quot;middleTouchMove&quot;
     @touchend=&quot;middleTouchEnd&quot;
&gt;

  middleTouchStart (e) {
      this.touch.initiated = true
      const touch = e.touches[0]
      this.touch.startX = touch.pageX
      this.touch.startY = touch.pageY
    },
    middleTouchMove (e) {
      if (!this.touch.initiated) {
        return
      }
      const touch = e.touches[0]
      const deltaX = touch.pageX - this.touch.startX
      const deltaY = touch.pageY - this.touch.startY
      if (Math.abs(deltaY) &gt; Math.abs(deltaX)) {
        return
      }
      const left = this.currentShow === 'cd' ? 0 : -window.innerWidth
      const offsetWidth = Math.min(0, Math.max(-window.innerWidth, left + deltaX))
      this.touch.percent = Math.abs(offsetWidth / window.innerWidth)
      this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`
      this.$refs.lyricList.$el.style[transitionDuration] = 0
      this.$refs.middleL.style.opacity = 1 - this.touch.percent
      this.$refs.middleL.style[transitionDuration] = 0
    },
    middleTouchEnd () {
      let offsetWidth
      let opacity
      if (this.currentShow === 'cd') {
        if (this.touch.percent &gt; 0.1) {
          offsetWidth = -window.innerWidth
          opacity = 0
          this.currentShow = 'lyric'
        } else {
          offsetWidth = 0
          opacity = 1
        }
      } else {
        if (this.touch.percent &lt; 0.9) {
          offsetWidth = 0
          this.currentShow = 'cd'
          opacity = 1
        } else {
          offsetWidth = -window.innerWidth
          opacity = 0
        }
      }
      const time = 300
      this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`
      this.$refs.lyricList.$el.style[transitionDuration] = `${time}ms`
      this.$refs.middleL.style.opacity = opacity
      this.$refs.middleL.style[transitionDuration] = `${time}ms`
      this.touch.initiated = false
    },
</code></pre></div><p>圆形进度条</p> <blockquote><p>利用SVG实现，其中有两个圆，一个是背景图形，另一个为已播放的图形进度</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>&lt;div class=&quot;progress-circle&quot;&gt;
        &lt;svg :width=&quot;radius&quot; :height=&quot;radius&quot; viewBox=&quot;0 0 100 100&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;
        &lt;!-- 写的32，但是半径是50，为什么还可以正常的铺在svg里面呢？因为viewBox，可以理解为一个舞台的大小 --&gt;
        &lt;!--r为半径，cx,cy是圆心坐标--&gt;
        &lt;circle class=&quot;progress-background&quot; r=&quot;50&quot; cx=&quot;50&quot; cy=&quot;50&quot; fill=&quot;transparent&quot;/&gt;
        &lt;circle class=&quot;progress-bar&quot; r=&quot;50&quot; cx=&quot;50&quot; cy=&quot;50&quot; fill=&quot;transparent&quot; :stroke-dasharray=&quot;dashArray&quot; :stroke-dashoffset=&quot;dashOffset&quot;/&gt;
        &lt;/svg&gt;
        &lt;slot&gt;&lt;/slot&gt;
    &lt;/div&gt;
</code></pre></div><p>歌词lyric</p> <p>获取歌词，虽然我们约定返回数据是 json，但QQ音乐 返回的是依然是 jsonp，所以我们需要做一层数据的处理</p> <div class="language- extra-class"><pre class="language-text"><code>const reg = /^\w+\(({.+})\)$/
</code></pre></div><p>就是将返回的jsonp格式摘取出我们需要的json字段</p> <div class="language- extra-class"><pre class="language-text"><code>ret = JSON.parse(matches[1])
</code></pre></div><p>将正则分组（就是正则括号内的内容）捕获的json字符串数据 转成 json 格式</p> <p>然后我们在 player 组件中监听 currentSong 的变化，获取 this.currentSong.getLyric()</p> <div class="language- extra-class"><pre class="language-text"><code>// 封装获取歌词的逻辑
    getLyric () {
      this.currentSong.getLyric().then((lyric) =&gt; {
        // console.log(lyric)
        if (this.currentSong.lyric !== lyric) {
          return
        }
        this.currentLyric = new Lyric(lyric, this.handleLyric)
        if (this.playing) {
          this.currentLyric.play()
        }
      }).catch(() =&gt; {
        this.currentLyric = null
        this.playingLyric = ''
        this.currentLineNum = 0
      })
    },
</code></pre></div><p>歌词滚动</p> <p>当前歌曲的歌词高亮是利用 js-lyric 会派发的 handle 事件</p> <div class="language- extra-class"><pre class="language-text"><code>this.currentLyric = new Lyric(lyric, this.handleLyric)
</code></pre></div><p>js-lyric 会在每次改变当前歌词时触发这个函数，函数的参数为 当前的 lineNum 和 txt</p> <p>当前高亮歌词保持最中间 是利用了 BScroll 滚动至高亮的歌词</p> <div class="language- extra-class"><pre class="language-text"><code>   handleLyric ({lineNum, txt}) {
      this.currentLineNum = lineNum
      if (lineNum &gt; 5) {
        let lineEl = this.$refs.lyricLine[lineNum - 5]
        this.$refs.lyricList.scrollToElement(lineEl, 1000)
      } else {
        this.$refs.lyricList.scrollTo(0, 0, 1000)
      }
      this.playingLyric = txt
    },
</code></pre></div><p>cd与歌词之间滚动</p> <p>通过监听 middle 的 三个 touch 事件</p> <p>offsetWidth 是为了计算歌词列表的一个偏移量的，首先它的偏移量不能大于0，也不能小于 -window.innerWidth</p> <p>left 是根据当前显示的是 cd 还是歌词列表初始化的位置，如果是 cd，那么 left 为 0 ，歌词是从右往左拖的，deltaX 是小于 0 的，所以最终它的偏移量就是 0+deltaX；如果已经显示歌词了，那么 left 为 -window.innerWidth，歌词是从左往右拖，deltaX 是大于 0 的，所以最终它的偏移量就是 -window.innerWidth + deltaX</p> <div class="language- extra-class"><pre class="language-text"><code>    middleTouchStart (e) {
      this.touch.initiated = true
      const touch = e.touches[0]
      this.touch.startX = touch.pageX
      this.touch.startY = touch.pageY
    },
    middleTouchMove (e) {
      if (!this.touch.initiated) {
        return
      }
      const touch = e.touches[0]
      const deltaX = touch.pageX - this.touch.startX
      const deltaY = touch.pageY - this.touch.startY
      if (Math.abs(deltaY) &gt; Math.abs(deltaX)) {
        return
      }
      const left = this.currentShow === 'cd' ? 0 : -window.innerWidth
      const offsetWidth = Math.min(0, Math.max(-window.innerWidth, left + deltaX))
      this.touch.percent = Math.abs(offsetWidth / window.innerWidth)
      this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`
      this.$refs.lyricList.$el.style[transitionDuration] = 0
      this.$refs.middleL.style.opacity = 1 - this.touch.percent
      this.$refs.middleL.style[transitionDuration] = 0
    },
    middleTouchEnd () {
      let offsetWidth
      let opacity
      if (this.currentShow === 'cd') {
        if (this.touch.percent &gt; 0.1) {
          offsetWidth = -window.innerWidth
          opacity = 0
          this.currentShow = 'lyric'
        } else {
          offsetWidth = 0
          opacity = 1
        }
      } else {
        if (this.touch.percent &lt; 0.9) {
          offsetWidth = 0
          this.currentShow = 'cd'
          opacity = 1
        } else {
          offsetWidth = -window.innerWidth
          opacity = 0
        }
      }
      const time = 300
      this.$refs.lyricList.$el.style[transform] = `translate3d(${offsetWidth}px,0,0)`
      this.$refs.lyricList.$el.style[transitionDuration] = `${time}ms`
      this.$refs.middleL.style.opacity = opacity
      this.$refs.middleL.style[transitionDuration] = `${time}ms`
      this.touch.initiated = false
    },
</code></pre></div><h2 id="歌单页面-2"><a href="#歌单页面-2" class="header-anchor">#</a> 歌单页面</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f46855efba9786?w=374&amp;h=665&amp;f=png&amp;s=140591" alt="cmd-markdown-logo"></p> <p>计数获取背景图片高度</p> <div class="language- extra-class"><pre class="language-text"><code>  mounted () {
    this.imageHeight = this.$refs.bgImage.clientHeight
    this.minTransalteY = -this.imageHeight + RESERVED_HEIGHT
    this.$refs.list.$el.style.top = `${this.imageHeight}px`
  },
</code></pre></div><p>设置scroll的偏移量</p> <div class="language- extra-class"><pre class="language-text"><code>  watch: {
    scrollY (newVal) {
      let translateY = Math.max(this.minTransalteY, newVal)
      let scale = 1
      let zIndex = 0
      // let blur = 0
      const percent = Math.abs(newVal / this.imageHeight)
      if (newVal &gt; 0) {
        scale = 1 + percent
        zIndex = 10
      }
      // else {
      //   blur = Math.min(20, percent * 20)
      // }
      this.$refs.layer.style[transform] = `translate3d(0,${translateY}px,0)`
      // this.$refs.filter.style[backdrop] = `blur(${blur}px)`
      if (newVal &lt; this.minTransalteY) {
        zIndex = 10
        this.$refs.bgImage.style.paddingTop = 0
        this.$refs.bgImage.style.height = `${RESERVED_HEIGHT}px`
        this.$refs.playBtn.style.display = 'none'
      } else {
        this.$refs.bgImage.style.paddingTop = '70%'
        this.$refs.bgImage.style.height = 0
        this.$refs.playBtn.style.display = ''
      }
    }
  }
</code></pre></div><p>下拉背景图片伸缩</p> <div class="language- extra-class"><pre class="language-text"><code>      this.$refs.bgImage.style[transform] = `scale(${scale})`
      this.$refs.bgImage.style.zIndex = zIndex
</code></pre></div><h2 id="排行榜页面-2"><a href="#排行榜页面-2" class="header-anchor">#</a> 排行榜页面</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3d20cd038149e?w=1242&amp;h=2056&amp;f=jpeg&amp;s=256563" alt="cmd-markdown-logo"></p> <p>普通组件</p> <div class="language- extra-class"><pre class="language-text"><code>    &lt;transition name=&quot;slide&quot;&gt;
      &lt;music-list :rank=&quot;rank&quot; :title=&quot;title&quot; :bg-image=&quot;bgImage&quot; :songs=&quot;songs&quot;&gt;&lt;/music-list&gt;
    &lt;/transition&gt;
</code></pre></div><p>使用jsonp抓取QQ音乐移动端数据</p> <div class="language- extra-class"><pre class="language-text"><code>import jsonp from 'common/js/jsonp'
import {commonParams, oprions} from './config'
// 获取推荐歌曲接口
export function getTopList () {
  const url = 'https://c.y.qq.com/v8/fcg-bin/fcg_myqq_toplist.fcg'
  const data = Object.assign({}, commonParams, {
    uin: 0,
    needNewCode: 1,
    platform: 'h5'
  })
  return jsonp(url, data, oprions)
}
</code></pre></div><h2 id="榜单列表页-2"><a href="#榜单列表页-2" class="header-anchor">#</a> 榜单列表页</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbb2f9dc87f7?w=1242&amp;h=2088&amp;f=jpeg&amp;s=235690" alt="cmd-markdown-logo"></p> <p>爬取QQ音乐数据</p> <div class="language- extra-class"><pre class="language-text"><code>export function getMusicList (topid) {
  const url = 'https://c.y.qq.com/v8/fcg-bin/fcg_v8_toplist_cp.fcg'
  const data = Object.assign({}, commonParams, {
    topid: topid,
    needNewCode: 1,
    uin: 0,
    tpl: 3,
    page: 'detail',
    type: 'top',
    platform: 'h5'
  })
  return jsonp(url, data, oprions)
}
</code></pre></div><h2 id="搜索页面-2"><a href="#搜索页面-2" class="header-anchor">#</a> 搜索页面</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbc52482240f?w=1242&amp;h=2061&amp;f=jpeg&amp;s=160394" alt="cmd-markdown-logo"></p> <p>抓数据</p> <div class="language- extra-class"><pre class="language-text"><code>import jsonp from 'common/js/jsonp'
import {commonParams, oprions} from './config'
/**
 * jsonp 抓取热门搜索数据
 * 接口：https://c.y.qq.com/splcloud/fcgi-bin/gethotkey.fcg
 * 提供方：https://m.y.qq.com/#search
 */
export function getHotKey () {
  const url = 'https://c.y.qq.com/splcloud/fcgi-bin/gethotkey.fcg'
  const data = Object.assign({}, commonParams, {
    uin: 0,
    needNewCode: 1,
    platform: 'h5'
  })
  return jsonp(url, data, oprions)
}

 * jsonp 抓取搜索检索数据
 * 接口：https://c.y.qq.com/soso/fcgi-bin/search_for_qq_cp
 * 提供方：https://m.y.qq.com/#search
 */
export function search (query, page, perpage, zhida) {
  let url = 'https://c.y.qq.com/soso/fcgi-bin/client_search_cp'
  let data = Object.assign({}, commonParams, {
    w: query,
    p: page,
    n: perpage,
    perpage,
    zhidaqu: 1,
    catZhida: zhida ? 1 : 0,
    t: 0,
    flag: 1,
    ie: 'utf-8',
    sem: 1,
    aggr: 1,
    uin: 0,
    platform: 'h5',
    uid: 0,
    needNewCode: 1,
    remoteplace: 'txt.mqq.all',
    g_tk: 5381
  })
  return jsonp(url, data, oprions)
}
</code></pre></div><p>对滚动前的input做了blur()操作</p> <blockquote><p>考虑到移动端键盘占屏的问题</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>    &lt;div class=&quot;search-result&quot; v-show=&quot;query&quot; ref=&quot;searchResult&quot;&gt;
      &lt;suggest @select=&quot;saveSearch&quot; ref=&quot;suggest&quot; @listScroll=&quot;blurInput&quot; :query=&quot;query&quot; :zhida=&quot;zhida&quot;&gt;&lt;/suggest&gt;
    &lt;/div&gt;
    
       // 使输入框去掉焦点
    blurInput () {
      this.$refs.searchBox.blur()
    },
</code></pre></div><p>保存搜索结果</p> <div class="language- extra-class"><pre class="language-text"><code> ...mapActions([
      'saveSearchHistory',
      'deleteSearchHistory',
      'clearSearchHistory'
    ])
</code></pre></div><h2 id="歌典列表页-2"><a href="#歌典列表页-2" class="header-anchor">#</a> 歌典列表页</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbd7d34860dc?w=1242&amp;h=2070&amp;f=jpeg&amp;s=175771" alt="cmd-markdown-logo"></p> <p>显示和管理当前播放歌曲</p> <div class="language- extra-class"><pre class="language-text"><code>    // 单曲循环
    loop () {
      // 将audio标签的当前时间currentTime设置为0进度条就会跑到最左边
      this.$refs.audio.currentTime = 0
      // 然后打开播放
      this.$refs.audio.play()
      this.setPlayingState(true)
      // 如果在单曲循环中再次播放时，就会出现歌词不会跳转到起始位置
      if (this.currentLyric) {
        this.currentLyric.seek(0)
      }
    },
    // 下一首歌
    next () {
      // 如果歌曲没有加载好就不让执行下一首歌
      if (!this.songReady) {
        return
      }
      if (this.playlist.length === 1) {
        this.loop()
        return
      } else {
        // 下一首索引值加1
        let index = this.currentIndex + 1
        // 顺序播放的情况
        if (index === this.playlist.length) {
          index = 0
        }
        // 调用mutation的方法
        this.setCurrentIndex(index)
        // 如果歌曲暂停时点击下一首歌要触发歌曲播放
        if (!this.playing) {
          this.togglePlaying()
        }
      }
      // 点击下一首歌后将原先的状态变为false
      this.songReady = false
    },
    // 上一首歌
    prev () {
      // 如果歌曲没有加载好就不让执行上一首歌
      if (!this.songReady) {
        return
      }
      if (this.playlist.length === 1) {
        this.loop()
        return
      } else {
        let index = this.currentIndex - 1
        if (index === -1) {
          index = this.playlist.length - 1
        }
        // 调用mutation的方法
        this.setCurrentIndex(index)
        // 如果歌曲暂停时点击上一首歌要触发歌曲播放
        if (!this.playing) {
          this.togglePlaying()
        }
      }
      // 点击下一首歌后将原先的状态变为false
      this.songReady = false
    },
</code></pre></div><h2 id="用户中心页-2"><a href="#用户中心页-2" class="header-anchor">#</a> 用户中心页</h2> <p><img src="https://user-gold-cdn.xitu.io/2019/12/25/16f3dbe1bd20e458?w=1242&amp;h=2079&amp;f=jpeg&amp;s=110868" alt="cmd-markdown-logo"></p> <p>“我的收藏” 和 “最近播放” 反映到界面上</p> <div class="language- extra-class"><pre class="language-text"><code>  data () {
    return {
      currentIndex: 0,
      switches: [
        {
          name: '我喜欢的'
        },
        {
          name: '最近听的'
        }
      ]
    }
  },
  computed: {
    noResult () {
      if (this.currentIndex === 0) {
        return !this.favoriteList.length
      } else {
        return !this.playHistory.length
      }
    },
    noResultDesc () {
      if (this.currentIndex === 0) {
        return '暂无收藏歌曲'
      } else {
        return '你还没有听过歌曲'
      }
    },
    ...mapGetters([
      'favoriteList',
      'playHistory'
    ])
  },
  methods: {
    handlePlaylist (playlist) {
      const bottom = playlist.length &gt; 0 ? '60px' : ''
      this.$refs.listWrapper.style.bottom = bottom
      this.$refs.favoriteList &amp;&amp; this.$refs.favoriteList.refresh()
      this.$refs.playList &amp;&amp; this.$refs.playList.refresh()
    },
    switchItem (index) {
      this.currentIndex = index
    },
    selectSong (song) {
      this.insertSong(new Song(song))
    },
    back () {
      this.$router.back()
    },
    random () {
      let list = this.currentIndex === 0 ? this.favoriteList : this.playHistory
      if (list.length === 0) {
        return
      }
      list = list.map((song) =&gt; {
        return new Song(song)
      })
      this.randomPlay({
        list
      })
    },
    ...mapActions([
      'insertSong',
      'randomPlay'
    ])
  },
</code></pre></div><h2 id="手机联调"><a href="#手机联调" class="header-anchor">#</a> 手机联调</h2> <p>手机、电脑必须是在同一WIFI下</p> <p>把配置 config 的 index.js 里的 host 改为 '0.0.0.0'</p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f45abc1e83bcf0?w=980&amp;h=539&amp;f=png&amp;s=83339" alt="cmd-markdown-logo"></p> <p>手机可以打开电脑的IP地址+端口查看</p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f45afc388e15bb?w=662&amp;h=482&amp;f=png&amp;s=20874" alt="cmd-markdown-logo"></p> <p><img src="https://user-gold-cdn.xitu.io/2019/12/27/16f45b05fa8d337f?w=519&amp;h=99&amp;f=png&amp;s=8990" alt="cmd-markdown-logo"></p> <h2 id="移动端调试工具"><a href="#移动端调试工具" class="header-anchor">#</a> 移动端调试工具</h2> <p>移动端console：vConsole</p> <h3 id="main-js"><a href="#main-js" class="header-anchor">#</a> main.js</h3> <div class="language- extra-class"><pre class="language-text"><code>import './common/js/vconsole'
</code></pre></div><h3 id="js-console-js"><a href="#js-console-js" class="header-anchor">#</a> js/console.js</h3> <div class="language- extra-class"><pre class="language-text"><code>import Vconsole from 'vconsole'
const vConsole = new Vconsole()
 
export default vconsole
</code></pre></div><p>移动端抓包工具：charles</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/page13/react_antd后台管理系统总结.html" class="prev">
        react_antd后台管理系统总结
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f3f0b164.js" defer></script><script src="/assets/js/2.284f78c8.js" defer></script><script src="/assets/js/15.8e83af5f.js" defer></script>
  </body>
</html>
