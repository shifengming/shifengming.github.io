<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>闭包 | 个人网站</title>
    <meta name="description" content="Welcome to come to my blog">
    
    
    <link rel="preload" href="/assets/css/0.styles.c9120bc4.css" as="style"><link rel="preload" href="/assets/js/app.baeebc12.js" as="script"><link rel="preload" href="/assets/js/45.7ca64b8f.js" as="script"><link rel="prefetch" href="/assets/js/10.51912ddf.js"><link rel="prefetch" href="/assets/js/11.e96c3ccb.js"><link rel="prefetch" href="/assets/js/12.3199951e.js"><link rel="prefetch" href="/assets/js/13.3c7197fa.js"><link rel="prefetch" href="/assets/js/14.907c91b1.js"><link rel="prefetch" href="/assets/js/15.bf14723d.js"><link rel="prefetch" href="/assets/js/16.86fb4ac7.js"><link rel="prefetch" href="/assets/js/17.e2cff3df.js"><link rel="prefetch" href="/assets/js/18.48c73241.js"><link rel="prefetch" href="/assets/js/19.8f6142cc.js"><link rel="prefetch" href="/assets/js/2.dd4257e1.js"><link rel="prefetch" href="/assets/js/20.0640987b.js"><link rel="prefetch" href="/assets/js/21.b3d737d8.js"><link rel="prefetch" href="/assets/js/22.3f190a25.js"><link rel="prefetch" href="/assets/js/23.e5855050.js"><link rel="prefetch" href="/assets/js/24.76d4e241.js"><link rel="prefetch" href="/assets/js/25.68803788.js"><link rel="prefetch" href="/assets/js/26.7c73d578.js"><link rel="prefetch" href="/assets/js/27.946ad60e.js"><link rel="prefetch" href="/assets/js/28.f7173b89.js"><link rel="prefetch" href="/assets/js/29.44cce327.js"><link rel="prefetch" href="/assets/js/3.c1011a22.js"><link rel="prefetch" href="/assets/js/30.ca9785fb.js"><link rel="prefetch" href="/assets/js/31.2ee0d2c0.js"><link rel="prefetch" href="/assets/js/32.c7418bd6.js"><link rel="prefetch" href="/assets/js/33.bf2abcee.js"><link rel="prefetch" href="/assets/js/34.abbc5d8e.js"><link rel="prefetch" href="/assets/js/35.b8cd562f.js"><link rel="prefetch" href="/assets/js/36.958f06a4.js"><link rel="prefetch" href="/assets/js/37.c043e7bb.js"><link rel="prefetch" href="/assets/js/38.6966b072.js"><link rel="prefetch" href="/assets/js/39.4724a334.js"><link rel="prefetch" href="/assets/js/4.ee255b66.js"><link rel="prefetch" href="/assets/js/40.1e6f0e95.js"><link rel="prefetch" href="/assets/js/41.de3a8b43.js"><link rel="prefetch" href="/assets/js/42.f5df9fc7.js"><link rel="prefetch" href="/assets/js/43.f8fa8e4a.js"><link rel="prefetch" href="/assets/js/44.c43bf2f3.js"><link rel="prefetch" href="/assets/js/46.dee8a320.js"><link rel="prefetch" href="/assets/js/47.9ee60df4.js"><link rel="prefetch" href="/assets/js/48.a4cd6b21.js"><link rel="prefetch" href="/assets/js/49.1f8ef22d.js"><link rel="prefetch" href="/assets/js/5.a54dcc21.js"><link rel="prefetch" href="/assets/js/50.765b05d2.js"><link rel="prefetch" href="/assets/js/51.d27860af.js"><link rel="prefetch" href="/assets/js/52.bf0188ba.js"><link rel="prefetch" href="/assets/js/53.5208a76e.js"><link rel="prefetch" href="/assets/js/54.ef3432ff.js"><link rel="prefetch" href="/assets/js/55.271739d0.js"><link rel="prefetch" href="/assets/js/56.c3f0caab.js"><link rel="prefetch" href="/assets/js/57.3ff1162b.js"><link rel="prefetch" href="/assets/js/58.27e5128c.js"><link rel="prefetch" href="/assets/js/59.30fa2cb1.js"><link rel="prefetch" href="/assets/js/6.9c13835b.js"><link rel="prefetch" href="/assets/js/60.32defecd.js"><link rel="prefetch" href="/assets/js/61.98a47375.js"><link rel="prefetch" href="/assets/js/62.f833acc8.js"><link rel="prefetch" href="/assets/js/63.9801a855.js"><link rel="prefetch" href="/assets/js/7.258c75b9.js"><link rel="prefetch" href="/assets/js/8.572091d6.js"><link rel="prefetch" href="/assets/js/9.6896af62.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9120bc4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人网站</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/page3/page1/" class="nav-link">前端技术</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">个人文章</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5c8f3303f265da612d633276" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://segmentfault.com/u/helloxiaoming" target="_blank" rel="noopener noreferrer" class="nav-link external">
  segmentfault
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_40588413" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/shifengming" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/page3/page1/" class="nav-link">前端技术</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">个人文章</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.im/user/5c8f3303f265da612d633276" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://segmentfault.com/u/helloxiaoming" target="_blank" rel="noopener noreferrer" class="nav-link external">
  segmentfault
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_40588413" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/shifengming" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS3</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>JavaScript</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/page3/JS字符串.html" class="sidebar-link">JS字符串</a></li><li><a href="/page3/JS数组.html" class="sidebar-link">JS数组</a></li><li><a href="/page3/EventLoop.html" class="sidebar-link">EventLoop</a></li><li><a href="/page3/js数据类型.html" class="sidebar-link">JavaScript 数据类型</a></li><li><a href="/page3/对象的深浅拷贝.html" class="sidebar-link">对象的深浅拷贝</a></li><li><a href="/page3/原型与原型链.html" class="sidebar-link">原型与原型链</a></li><li><a href="/page3/this理解.html" class="sidebar-link">this理解</a></li><li><a href="/page3/JavaScript继承.html" class="sidebar-link">Javscript继承</a></li><li><a href="/page3/JS常见比较.html" class="sidebar-link">JS常见比较</a></li><li><a href="/page3/闭包.html" class="active sidebar-link">闭包</a></li><li><a href="/page3/重点题.html" class="sidebar-link">重点题</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JQuery</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Github</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Http请求</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Ajax</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>项目</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h1> <h4 id="问题？"><a href="#问题？" class="header-anchor">#</a> 问题？</h4> <ul><li>什么是闭包？</li> <li>闭包有哪些实际运用场景？</li> <li>闭包是如何产生的？</li> <li>闭包产生的变量如何被回收？</li></ul> <blockquote><p>闭包的底层实现原理</p></blockquote> <p><strong>JS 执行上下文</strong></p> <p>js 代码是要经过浏览器 V8 进行预编译后才能真正的被执行</p> <p>js 执行上下文分三种:</p> <ol><li>全局执行上下文： 代码开始执行时首先进入的环境</li> <li>函数执行上下文：函数调用时，会开始执行函数中的代码</li> <li>eval 执行上下文：不建议使用，可忽略</li></ol> <p>那么，执行上下文的周期，分为两个阶段：</p> <ul><li>创建阶段
<ul><li>创建词法环境</li> <li>生成变量对象(VO)，建立作用域链、作用域链、作用域链（重要的事说三遍）</li> <li>确认 this 指向，并绑定 this</li></ul></li> <li>执行阶段。这个阶段进行变量赋值，函数引用及执行代码</li></ul> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ace0f4de07cd490695c11e7fd08af2a1~tplv-k3u1fbpfcp-watermark.image" alt></p> <p><strong>预编译发生在函数执行之前</strong>。预编译四部曲为：</p> <ol><li>创建 AO 对象</li> <li>找形参和变量声明，将变量和形参作为 AO 属性名，值为 undefined</li> <li>将实参和形参相统一</li> <li>在函数体里找到函数声明，值赋予函数体。最后程序输出变量值的时候，就是从 AO 对象中拿</li></ol> <blockquote><ol><li>什么叫变量对象？</li></ol></blockquote> <p>变量对象是 js 代码在进入执行上下文时，js 引擎在内存中建立的一个对象，用来存放当前执行环境中的变量。</p> <blockquote><ol start="2"><li>变量对象(VO)的创建过程</li></ol></blockquote> <p>变量对象的创建，是在执行上下文创建阶段，依次经过以下三个过程：</p> <ul><li><p>创建 arguments 对象</p> <p>对于函数执行环境，首先查询是否有传入的实参，如果有，则会将参数名是实参值组成的键值对放入 arguments 对象中。否则，将参数名和 undefined 组成的键值对放入 arguments 对象中</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span> <span class="token comment">// [1, 2]</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>当遇到同名的函数时，后面的会覆盖前面的</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// function a() {console.log('Is a ?') }</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is a'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is a ?'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 在执行第一行代码之前，函数声明已经创建完成.后面的对之前的声明进行了覆盖</span>
</code></pre></div><ul><li>检查当前环境中的变量声明并赋值为 undefined。当遇到同名的函数声明，为了避免函数被赋值为 undefined ,会忽略此声明</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// function a() {console.log('Is a ?') }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is a '</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is a ?'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">'Is b'</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10086</span>
<span class="token comment">// 这段代码执行一下，你会发现 a 打印结果仍旧是一个函数，而 b 则是 undefined</span>
</code></pre></div><blockquote><ol start="3"><li>变量对象变为活动对象</li></ol></blockquote> <p>执行上下文的第二个阶段，称为执行阶段，在此时，会进行变量赋值，函数引用并执行其他代码，此时，变量对象变为活动对象</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// function a() {console.log('fjdsfs') }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is a'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Is a?'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">'Is b'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// 'Is b'</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10086</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 10086</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">'Is b?'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// 'Is b?'</span>
</code></pre></div><p>在上面的代码中，代码真正开始执行是从第一行 console.log() 开始的，自这之前，执行上下文是这样的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建过程</span>
<span class="token constant">EC</span><span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">VO</span>： <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 创建变量对象</span>
  <span class="token literal-property property">scopeChain</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 作用域链</span>
<span class="token punctuation">}</span>
<span class="token constant">VO</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">argument</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 当前为全局上下文，所以这个属性值是空的</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token operator">&lt;</span>a reference<span class="token operator">&gt;</span> <span class="token comment">// 函数 a  的引用地址</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> undefiend  <span class="token comment">// 见上文创建变量对象的第三步</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>词法作用域（Lexical scope）</li></ul> <p>这里想说明，我们在函数执行上下文中有变量，在全局执行上下文中有变量。JavaScript 的一个复杂之处在于它如何查找变量，如果在函数执行上下文中找不到变量，它将在调用上下文中寻找它，如果在它的调用上下文中没有找到，就一直往上一级，直到它在全局执行上下文中查找为止。(如果最后找不到，它就是 undefined)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> top <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//</span>
<span class="token keyword">function</span> <span class="token function">createWarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ret <span class="token operator">=</span> a <span class="token operator">+</span> b
    <span class="token keyword">return</span> ret
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> add
<span class="token punctuation">}</span>
<span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token function">createWarp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
</code></pre></div><p>分析过程如下：</p> <ol><li>在全局上下文中声明变量 top 并赋值为 0.</li> <li>2 - 8 行。在全局执行上下文中声明了一个名为 createWarp 的变量，并为其分配了一个函数定义。其中第 3-7 行描述了其函数定义，并将函数定义存储到那个变量(createWarp)中</li> <li>第 9 行。我们在全局执行上下文中声明了一个名为 sum 的新变量，暂时，值为 undefined</li> <li>第 9 行。遇到()，表明需要执行或调用一个函数。那么查找全局执行上下文的内存并查找名为 createWarp 的变量。 明显，已经在步骤 2 中创建完毕。接着，调用它</li> <li>调用函数时，回到第 2 行。创建一个新的 createWarp 执行上下文。我们可以在 createWarp 的执行上下文中创建自有变量。js 引擎 createWarp 的上下文添加到调用堆栈（call stack）。因为这个函数没有参数，直接跳到它的主体部分</li> <li>3 - 6 行。我们有一个新的函数声明，在 createWarp 执行上下文中创建一个变量 add。add 只存在于 createWarp 执行上下文中, 其函数定义存储在名为 add 的自有变量中</li> <li>第 7 行，我们返回变量 add 的内容。js 引擎查找一个名为 add 的变量并找到它. 第 4 行和第 5 行括号之间的内容构成该函数定义</li> <li>createWarp 调用完毕，createWarp 执行上下文将被销毁。add 变量也跟着被销毁。 但 add 函数定义仍然存在，因为它返回并赋值给了 sum 变量。 （ps: 这才是闭包产生的变量存于内存当中的真相）</li> <li>接下来就是简单的执行过程，不再赘述
...</li> <li>代码执行完毕，全局执行上下文被销毁。sum 和 result 也跟着被销毁</li></ol> <blockquote><p>所以，什么是闭包？</p></blockquote> <ul><li>解释一下作用域链是如何产生的</li> <li>解释一下 js 执行上下文的创建、执行过程</li> <li>解释一下闭包所产生的变量放在哪了
最后请把以上 3 点结合起来说给面试官听</li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.baeebc12.js" defer></script><script src="/assets/js/45.7ca64b8f.js" defer></script>
  </body>
</html>
